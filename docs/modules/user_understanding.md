# user_understanding 模块设计文档

## 1. 模块职责

user_understanding 负责管理用户长期背景信息（画像/记忆），为导购提供“历史偏好”而非“当前意图”。

## 2. 输入/输出

## 2.1 输入（前端 mock）

1. 点击记录（最近 20）
2. 加购记录（最近 20）
3. 购买记录（最近 20）
4. 搜索记录（最近 40）
5. AI 导购压缩对话（最近 40）

## 2.2 输出（核心）

1. 画像 markdown
2. 个性化欢迎语
3. 离线推荐商品列表
4. 更新元信息（时间、触发事件）

## 2.3 画像 markdown 结构建议

```markdown
# 用户画像

## 1) 稳定偏好
- 人群/性别倾向：...
- 尺码档案：...
- 风格取向：...

## 2) 使用场景偏好
- 通勤/日常/旅行：...
- 功能需求：...

## 3) 明确约束
- 不喜欢/禁忌：...

## 4) 行为证据
- [点击] xxx（3天前）
- [搜索] xxx（1天前）
```

## 3. 更新策略

1. 手动按钮触发（MVP 阶段）。
2. 对话结束触发（后续）。
3. 冲突消解：
   - 新近明确表态 > 历史推断
   - 证据不足时标记 `low_confidence`

## 4. 与 Assistant 的边界

- 本模块不定义当前轮意图。
- 仅提供背景信息与限制条件。
- 注入提示词时须注明“当前输入优先”。

## 5. 日志要求

- 输入行为摘要
- 画像更新 diff
- 证据链
- 更新触发类型

# user_understanding 模块设计

## 1. 目标

维护用户长期记忆（会话前历史行为 + 历史对话摘要），并在前端 mock 数据基础上生成可被导购使用的画像 markdown。

## 2. 输入（前端 mock）

- 最近点击/加购/购买（各 20 条）
- 搜索记录（40 条，最近 10 条含详细行为）
- AI 导购历史摘要（40 条）
- 当前会话（若由对话触发更新）

## 3. 输出

### 3.1 用户画像 markdown
1. 稳定偏好（人群、尺码、风格等）
2. 使用场景偏好
3. 明确约束/雷区
4. 行为证据摘要（每条画像需有证据）

### 3.2 辅助产物
- `personalized_welcome_message`
- `offline_recommendation_list`（候选商品 ID + 推荐原因）

## 4. 更新机制（当前阶段）

- 不做自动触发。
- 由前端按钮手动触发：
  1. 更新画像
  2. 生成个性化欢迎语

## 5. 与 assistant 协作原则

- 画像作为“背景”，不能压制用户当前表达。
- 当当前需求与历史偏好冲突时，以当前需求优先。
- 如识别到新禁忌/新档案信息，建议在回合结束后写回画像。

## 6. 建议数据文件

```text
user_understanding/
├── mock_inputs/
│   ├── user_behavior.json
│   └── conversation_history.json
└── output/
    ├── user_profile.md
    ├── recommendation_list.json
    └── personalized_welcome.txt
```

