# user_understanding 模块设计文档

## 1. 模块职责

user_understanding 负责管理用户长期背景信息（画像/记忆），为导购提供“历史偏好”而非“当前意图”。

## 2. 输入/输出

## 2.1 输入（前端 mock）

1. 点击记录（最近 20）
2. 加购记录（最近 20）
3. 购买记录（最近 20）
4. 搜索记录（最近 40）
5. AI 导购压缩对话（最近 40）

## 2.2 输出（核心）

1. 画像 markdown
2. 个性化欢迎语
3. 离线推荐商品列表
4. 更新元信息（时间、触发事件）

## 2.3 画像 markdown 结构建议

```markdown
# 用户画像

## 1) 稳定偏好
- 人群/性别倾向：...
- 尺码档案：...
- 风格取向：...

## 2) 使用场景偏好
- 通勤/日常/旅行：...
- 功能需求：...

## 3) 明确约束
- 不喜欢/禁忌：...

## 4) 行为证据
- [点击] xxx（3天前）
- [搜索] xxx（1天前）
```

## 3. 更新策略

1. 手动按钮触发（MVP 阶段）。
2. 对话结束触发（后续）。
3. 冲突消解：
   - 新近明确表态 > 历史推断
   - 证据不足时标记 `low_confidence`

## 4. 与 Assistant 的边界

- 本模块不定义当前轮意图。
- 仅提供背景信息与限制条件。
- 注入提示词时须注明“当前输入优先”。

## 5. 日志要求

- 输入行为摘要
- 画像更新 diff
- 证据链
- 更新触发类型

